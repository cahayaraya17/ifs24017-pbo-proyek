<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout/main}">
<head>
    <title>Statistik Galeri - PixelGallery</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        /* --- CSS Variables & Global Styles (Sama dengan Dashboard/List) --- */
        :root {
            --bg-color: #E8DFD8;
            --text-primary: #5A4638;
            --text-secondary: #8C7B70;
            --glass-bg: rgba(255, 255, 255, 0.45);
            --glass-border: rgba(255, 255, 255, 0.6);
        }

        body {
            background-color: var(--bg-color);
            background: linear-gradient(135deg, #E8DFD8 0%, #DBC8BC 100%);
            color: var(--text-primary);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        h1, h2, h3, h4, h5, h6 { color: var(--text-primary); }

        /* --- Glassmorphism Card --- */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: 0 8px 32px 0 rgba(90, 70, 56, 0.05);
        }

        /* --- Button Back Style --- */
        .btn-theme-secondary {
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(255,255,255, 0.6);
            color: var(--text-primary);
            border-radius: 50px;
            padding: 10px 20px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
        }

        .btn-theme-secondary:hover {
            background: rgba(255, 255, 255, 0.7);
            color: var(--text-primary);
            transform: translateX(-3px); /* Efek geser sedikit saat hover */
        }
    </style>
</head>
<body>
<div layout:fragment="content" class="container py-5">
    
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="fw-bold display-6 mb-1">Analisis Karya</h2>
            <p class="mb-0" style="color: var(--text-secondary);">Sebaran kategori foto dalam portofoliomu</p>
        </div>
        <a th:href="@{/photos}" class="btn-theme-secondary">
            <i class="bi bi-arrow-left me-2"></i> Kembali ke Galeri
        </a>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="glass-card p-4 p-md-5">
                <div class="text-center mb-4">
                    <h5 class="fw-bold text-uppercase opacity-75" style="letter-spacing: 1px;">Distribusi Kategori</h5>
                </div>
                
                <div style="position: relative; height: 350px; width: 100%;">
                    <canvas id="categoryChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        /* Mengambil data dari controller Thymeleaf */
        var rawData = /*[[${chartData}]]*/ [];
        
        var labels = rawData.map(item => item[0]); // Kategori
        var data = rawData.map(item => item[1]);   // Jumlah

        /* --- Palet Warna Earth Tones --- */
        // Kita definisikan warna yang senada dengan tema, bukan warna default chartjs
        const earthTonesPalette = [
            'rgba(90, 70, 56, 0.8)',   // Cokelat Tua
            'rgba(141, 110, 99, 0.8)', // Cokelat Sedang
            'rgba(166, 139, 124, 0.8)',// Latte
            'rgba(215, 204, 200, 0.9)',// Krem Gelap
            'rgba(121, 85, 72, 0.8)',  // Cokelat Kayu
            'rgba(109, 114, 96, 0.8)'  // Hijau Olive Muted (untuk variasi)
        ];

        const ctx = document.getElementById('categoryChart').getContext('2d');
        
        // Konfigurasi Font Global agar sesuai tema
        Chart.defaults.color = '#5A4638'; 
        Chart.defaults.font.family = "'Segoe UI', sans-serif";

        const myChart = new Chart(ctx, {
            type: 'doughnut', 
            data: {
                labels: labels,
                datasets: [{
                    label: 'Jumlah Foto',
                    data: data,
                    backgroundColor: earthTonesPalette,
                    borderColor: 'rgba(255, 255, 255, 0.5)', // Border antar slice semi-transparan
                    borderWidth: 2,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            font: {
                                size: 12,
                                weight: '600'
                            },
                            usePointStyle: true, // Ubah kotak legend jadi bulat
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: 'rgba(90, 70, 56, 0.9)', // Tooltip cokelat tua
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 10,
                        cornerRadius: 10,
                        displayColors: false
                    }
                },
                cutout: '65%', // Membuat lubang tengah donat lebih besar (lebih elegan)
                animation: {
                    animateScale: true,
                    animateRotate: true
                }
            }
        });
    </script>
</div>
</body>
</html>